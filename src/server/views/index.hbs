<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8">
  <title>#codevember 07-2016 <Hexagon Weather Widgets></title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">

  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Raleway:400,700,800'>

  <link rel="stylesheet" href="stylesheets/style.css">

  <script>
      window.onload = function () {
        var itemp = JSON.parse(decodeURIComponent("{{{itemp}}}"));
        var otemp = JSON.parse(decodeURIComponent("{{{otemp}}}"));
        var ihum = JSON.parse(decodeURIComponent("{{{ihum}}}"));
        var ohum = JSON.parse(decodeURIComponent("{{{ohum}}}"));
        
        var tempchart = new CanvasJS.Chart("beehivetemp", {
            title: {
                text: "Temperature Data"
            },

            responsive: true,
            animationEnabled: true,
            exportEnabled: true,

            data: [
                {
                    type: "line", 
                    dataPoints: otemp,
                    lineColor:"orange"
                },
                {
                    type: "line", //change it to line, area, column, pie, etc
                    dataPoints: itemp,
                    lineColor:"black"
                }
            ],
        });

        var humchart = new CanvasJS.Chart("beehivehumidity", {
            title: {
                text: "Humidity Data"
            },

            responsive: true,
            animationEnabled: true,
            exportEnabled: true,

            data: [
                {
                    type: "line", 
                    dataPoints: ohum,
                    lineColor:"orange"
                },
                {
                    type: "line", //change it to line, area, column, pie, etc
                    dataPoints: ihum,
                    lineColor:"black"
                }
            ],
        });

        tempchart.render();

        humchart.render();

        var updateChart = function (data) {
            var counter = itemp[itemp.length-1].x + 1;
            
            itemp.push({x:counter,y:Number(data.itemp)});
            otemp.push({x:counter,y:Number(data.otemp)});
            ihum.push({x:counter,y:Number(data.ihum)});
            ohum.push({x:counter,y:Number(data.ohum)});

            tempchart.render();
            humchart.render();

            console.log("new data");
            console.log(data);
            
            $("#otemp_recent").text(data.otemp);
            $("#itemp_recent").text(data.itemp);    
            $("#ohum_recent").text(data.ohum);
            $("#ihum_recent").text(data.ihum);
        
        };

        var socket = io();
        socket.on('new_data',(data)=>{
            updateChart(data.result);
        });

      }
  </script>

</head>

<body>
    <center><h1>Realtime Embedded Systems Programming Coursework</h1></center>
    <br/>
    <br/>

    <div class="row">
    <div class="hex slide snow">
      <div class="front">
        <h5>Outside temperature</h5>
        <h3 id="otemp_recent">{{recentData.otemp}}째C</h3>
      </div>
    </div>

    <div class="hex slide storm">
      <div class="front">
        <h5>Inside temperature</h5>
        <h3 id="itemp_recent">{{recentData.itemp}}째C</h3>
      </div>
    </div>
    </div>

    <div class="row">
    <div class="hex slide rain">
      <div class="front">
        <h5>Outside humidity</h5>
        <h3 id="ohum_recent">{{recentData.ohum}}째C</h3>
      </div>
    </div>

    <div class="hex slide moon">
      <div class="front">
        <h5>Inside humidity</h5>
        <h3 id="ihum_recent">{{recentData.ihum}}째C</h3>
      </div>
    </div>

    <div class="hex slide sunny">
      <div class="front">
        <h5>Beehive weight</h5>
        <h3>10g</h3>
      </div>
    </div>
    </div>

    <br/>
    <br/>
    <br/>
    <br/>
    <br/>


    <center><div id="beehivetemp" style="height: 370px; width: 50%;"></div></center>
    <br>
    <br>
    <center><div id="beehivehumidity" style="height: 370px; width: 50%;"></div></center>
    <br>

    <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>
    <script src='https://use.fontawesome.com/97152d9c6b.js'></script>
    <script src="/socket.io/socket.io.js"></script>

</body>

</html>
